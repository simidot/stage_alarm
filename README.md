# Stage-Alarm

- í”„ë¡œì íŠ¸ ê¸°ê°„: 2024.03.13 ~ 05.03
  - 1ì°¨ í”„ë¡œì íŠ¸ ê¸°ê°„: 03.13 ~ 04.04
  - 2ì°¨ í”„ë¡œì íŠ¸ ê¸°ê°„: 04.08 ~ 05.03
- ì°¸ì—¬ ì¸ì›: BE 4ëª…


##  ğŸ³Overview

<div align="center">


| ì†Œê°œ ì˜ìƒ |
|:-----:|
| [![ì†Œê°œ ì˜ìƒ ìœ íŠœë¸Œë¡œ ë³´ê¸°](https://img.youtube.com/vi/Z9pxJ1-OkzQ/0.jpg)](https://www.youtube.com/watch?v=Z9pxJ1-OkzQ&t=10s) |
|   ![i5](https://github.com/TECHIT-TEAM-i5/stage_alarm/assets/128130163/fbd350a1-4eb7-470b-a8ee-5bd5a0ea5900)   |



> âœ¨ì˜¤ì§ ë‹¹ì‹ ì˜, ë‹¹ì‹ ì— ì˜í•œ, ë‹¹ì‹ ì„ ìœ„í•œ ê³µì—° & ì¥ë¥´ ì•Œë¦¼ ì„œë¹„ìŠ¤âœ¨

`Stage-Alarm`ì€ ë‹¹ì‹ ì´ ì¢‹ì•„í•˜ëŠ” ì•„í‹°ìŠ¤íŠ¸ì™€ ì¥ë¥´ë¥¼ êµ¬ë…í•¨ìœ¼ë¡œì„œ,   
í•´ë‹¹ ì†Œì‹ê³¼ ê³µì—° ì •ë³´ë“¤ì„ ë©”ì¼ë¡œ ì•Œë ¤ì¤˜ ì„±ê³µí•˜ëŠ” ë•í›„, ì´ë¥¸ë°” ì„±ë•ì˜ í™œë™ì— ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.  
`Stage-Alarm` ì„œë¹„ìŠ¤ì˜ ë§¤ë ¥ì— ë¹ ì ¸ë³´ì„¸ìš”!

</div>


##  ğŸš©Project

<div align="center">
  <p>ğŸ’¾ BACKEND</p>
    <img src="https://img.shields.io/badge/Java 17-FF160B?style=flat-square&logo=java&logoColor=white"/>
    <img src="https://img.shields.io/badge/Spring Boot-6DB33F?style=flat-square&logo=springboot&logoColor=white"/>
    <img src="https://img.shields.io/badge/Spring Security-6DB33F?style=flat-square&logo=springsecurity&logoColor=white"/>
    <img src="https://img.shields.io/badge/JsonWebToken-000000?style=flat-square&logo=JSON Web Tokens&logoColor=white"/>
    <img src="https://img.shields.io/badge/Querydsl-white?style=flat-square&logo=querydsl&logoColor=white"/>
    <img src="https://img.shields.io/badge/JPA-088142?style=flat-square&logo=jpa&logoColor=white"/>
<img src="https://img.shields.io/badge/HTTP Interface-008FC7?style=flat-square&logo=jpa&logoColor=white"/>
  <p>ğŸ–¥ï¸ FRONTEND</p>
    <img src="https://img.shields.io/badge/HTML-E34F26?style=flat-square&logo=html5&logoColor=white"/>
    <img src="https://img.shields.io/badge/CSS-1572B6?style=flat-square&logo=css3&logoColor=white"/>
    <img src="https://img.shields.io/badge/BootStrap-7952B3?style=flat-square&logo=bootstrap&logoColor=white"/>
    <img src="https://img.shields.io/badge/Thymeleaf-005F0F?style=flat-square&logo=thymeleaf&logoColor=white"/>
    <img src="https://img.shields.io/badge/jQuery-0769AD?style=flat-square&logo=jquery&logoColor=white"/>
    <img src="https://img.shields.io/badge/JavaSript-F7DF1E?style=flat-square&logo=javascript&logoColor=white"/>
    <img src="https://img.shields.io/badge/FullCalendar-528DD7?style=flat-square&logo=fullcalendar&logoColor=white"/>
    <img src="https://img.shields.io/badge/Font Awesome-528DD7?style=flat-square&logo=font awesome&logoColor=white"/>
  <p>âš’ï¸ ETC</p>
    <img src="https://img.shields.io/badge/AWS S3-569A31?style=flat-square&logo=amazon s3&logoColor=white"/>
    <img src="https://img.shields.io/badge/SQLite-003B57?style=flat-square&logo=sqlite&logoColor=white"/>
    <img src="https://img.shields.io/badge/Jakarta Mail-F06B66?style=flat-square&logo=jakartamail&logoColor=white"/>
    <img src="https://img.shields.io/badge/Redis-DC382D?style=flat-square&logo=redis&logoColor=white"/>
    <img src="https://img.shields.io/badge/Swagger-85EA2D?style=flat-square&logo=swagger&logoColor=white"/>
    <img src="https://img.shields.io/badge/Erdcloud-171C36?style=flat-square&logo=erdcloud&logoColor=white"/>
    <img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=github&logoColor=white"/>
    <img src="https://img.shields.io/badge/Notion-000000?style=flat-square&logo=notion&logoColor=white"/>
    <img src="https://img.shields.io/badge/Figma-F24E1E?style=flat-square&logo=figma&logoColor=white"/>
  <br>
    <img src="https://img.shields.io/badge/Amazon EC2-FF9900?style=flat-square&logo=amazonec2&logoColor=white"/>
    <img src="https://img.shields.io/badge/Naver Cloud Platform-057B00?style=flat-square&logo=&logoColor=white"/>
    <img src="https://img.shields.io/badge/GitHub Actions-2088FF?style=flat-square&logo=githubactions&logoColor=white"/>
    <img src="https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=docker&logoColor=white"/>
    <img src="https://img.shields.io/badge/Kubernetes-326CE5?style=flat-square&logo=kubernetes&logoColor=white"/>
  <br>
    <img src="https://img.shields.io/badge/nGrinder-E6502A?style=flat-square&logo=ngrinder&logoColor=white"/>
    <img src="https://img.shields.io/badge/Grafana-F46800?style=flat-square&logo=grafana&logoColor=white"/>
    <img src="https://img.shields.io/badge/Prometheus-E6522C?style=flat-square&logo=prometheus&logoColor=white"/>
    <img src="https://img.shields.io/badge/RabbitMQ-FF6600?style=flat-square&logo=rabbitmq&logoColor=white"/>
    <img src="https://img.shields.io/badge/Selenium-43B02A?style=flat-square&logo=selenium&logoColor=white"/>
    <img src="https://img.shields.io/badge/Jsoup-304CB2?style=flat-square&logo=jsoup&logoColor=white"/>
</div>

<details>
<summary><strong>ê¸°íš ê³¼ì •</strong></summary>


<p style="font-size: 20px">ë§¤ì£¼ í‰ì¼, ì˜¤í›„ 13:00ì— ê°„ë‹¨í•œ íšŒì˜ ì§„í–‰(ê¸°íš ì•„ì´í…œ í† ì˜, ì§„í–‰ìƒí™© & íŠ¹ì´ì‚¬í•­ ê³µìœ )</p>

![conference](image/coffee-chat.png)

---

<p style="font-size: 20px">íŒ€ ê·œì¹™</p>

![tean-rule](image/team-rule.png)

---
 
<p style="font-size: 20px">ì—­í•  ë¶„ë°° (ì¶œì²˜. Google-docs)</p>

![google](image/google-docs.png)  

---

![code-convention](image/code-convention.png)

---

![git-branch](image/git-branch.png)

---
 
![discussion](image/discusstion.png)

---
 
![justice](image/request.png)
</details>

<details>
<summary><strong>ì•„í‚¤í…ì²˜</strong></summary>

MSA ì•„í‚¤í…ì²˜ë¡œ êµ¬ì„±

1. Main Server
2. Crawling Server
3. Alarm Server

- Version. A (Kubernetes ì„œë²„ í™˜ê²½)
![version-a](image/version-a.png)

- Version. B (AWS EC2 CI/CD)
![version-b](image/version-b.png)
</details>

<details>
<summary><strong>ERD</strong></summary>

![ERD](image/ERD.png)
</details>

<details>
<summary><strong>API ëª…ì„¸ì„œ</strong></summary>

http://localhost:8080/swagger-ui/index.html


![API ëª…ì„¸ì„œ](image/api-ëª…ì„¸ì„œ.png)
</details>

<details>
<summary><strong>nGrinder í…ŒìŠ¤íŠ¸ ê²°ê³¼</strong></summary>

<p style="font-size: 20px">ê²°ê³¼ ê·¸ë˜í”„</p>

![nGrinder-result](image/nGrinder-result.png)

`ì‹¤í—˜ ì¡°ê±´`  
Vusers: 3000  
Run time: 3m  
ë°°í¬ ì„œë²„ ìŠ¤íŒ©: CPU 2ê°œ, ë©”ëª¨ë¦¬ 8GB


`ì‹¤í—˜ ëª©ì `  
 ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ í†µí•´ êµ¬í˜„í•œ ì˜¤í†  ìŠ¤ì¼€ì¼ë§(Autoscaling), ë¡œë“œ ë°¸ëŸ°ì‹±(load balancing) ê¸°ëŠ¥ê³¼  
í•¨ê»˜ ë°°í¬í•œ ì„œë²„ë“¤ì˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ í•œ ì‹¤í—˜ì´ë‹¤.

 ë³¸ ì‹¤í—˜ì˜ ëª©ì ì€ ë°°í¬ëœ ì„œë²„ì˜ ê°œìˆ˜ì— ë”°ë¼ ê°ë‹¹í•  ìˆ˜ ìˆëŠ” ë¶€í•˜ëŸ‰ì„ ì¸¡ì •í•˜ê¸° ìœ„í•¨ì´ë©°  
ë°°í¬ëœ ì„œë²„ê°€ ë§ì„ ìˆ˜ë¡ ë¶€í•˜ë¥¼ ê³ ë¥´ê²Œ ë¶„ì‚°í•  ìˆ˜ ìˆì–´ ì•ˆì •ì ì´ê³  ì„±ëŠ¥ í–¥ìƒì„ í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì¦ëª…í•˜ê¸° ìœ„í•¨ì´ë‹¤.

---

<p style="font-size: 20px">ìƒì„¸ ê·¸ë˜í”„</p>

`ì„œë²„ 1ê°œ`
![single-test](image/single-test.png)

---
`ì„œë²„ 2ê°œ`
![double-test](image/double-test.png)

---
`ì„œë²„ 3ê°œ`
![triple-test](image/triple-test.png)  

---
`ì„œë²„ 4ê°œ`
![quadruple-test](image/quadruple-test.png)
</details>

<details>
<summary><strong>ëª¨ë‹ˆí„°ë§(Grafana + Prometheus)</strong></summary>

![monitoring](image/monitoring.png)

ëª¨ë‹ˆí„°ë§ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ì €ì¥í•˜ì—¬ ì‹œê°í™”í•˜ì˜€ë‹¤.  
(CPU ì‚¬ìš©ë¥ , ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ , HTTP íŠ¸ë˜í”½ ê°ì‹œ ë“±ë“±)
</details>


##  ğŸ“ ì£¼ìš” ê¸°ëŠ¥

<p style="font-size: 20px">Life Cycle</p>

![LifeCycle](image/LifeCycle.png)

`ê´€ë¦¬ì`
- ê³µì—°, ì•„í‹°ìŠ¤íŠ¸, ì¥ë¥´ë¥¼ ë“±ë¡ ë° ê´€ë¦¬ë¥¼ í•œë‹¤.

`ì‚¬ìš©ì`
- ì‚¬ìš©ìëŠ” ìì‹ ì´ ì¢‹ì•„í•˜ëŠ” ì•„í‹°ìŠ¤íŠ¸ì™€ ì¥ë¥´ë¥¼ êµ¬ë…í•œë‹¤.  
- êµ¬ë…í•œ ì•„í‹°ìŠ¤íŠ¸ ë˜ëŠ” ì¥ë¥´ë¥¼ í¬í•¨í•˜ëŠ” ê³µì—°ì´ ì—´ë¦¬ë©´ ì‚¬ìš©ìì—ê²Œ ë©”ì¼ ë°œì†¡ìœ¼ë¡œ ì•Œë¦¼ì´ ê°„ë‹¤.
- ê³µì—°ì— ê´€í•œ ì¢‹ì•„ìš” ë° ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- ê²Œì‹œíŒ(ê³µì—° í›„ê¸°, ì•„í‹°ìŠ¤íŠ¸, ììœ , ë™í–‰)ì„ ììœ ë¡­ê²Œ ì‘ì„± ë° ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆë‹¤.

---

<p style="font-size: 20px">Unlogin User</p>

1. ì•„í‹°ìŠ¤íŠ¸ ì¡°íšŒ & ê²€ìƒ‰ì„ í•  ìˆ˜ ìˆë‹¤.
2. ê³µì—° ì •ë³´ ìº˜ë¦°ë” & ê³µì—° ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
3. ê²Œì‹œê¸€ì„ ë³¼ ìˆ˜ ìˆë‹¤.
4. ê³µì—° ì•„ì´í…œì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

---

<p style="font-size: 20px">Login User</p>

1. íšŒì›ê°€ì…, ë¡œê·¸ì¸
   - ìì²´ íšŒì›ê°€ì… ë˜ëŠ” ì†Œì…œ ë¡œê·¸ì¸ **(ë„¤ì´ë²„, ì¹´ì¹´ì˜¤)** ì„ í•  ìˆ˜ ìˆë‹¤.
   - ë¡œê·¸ì¸ **(Spring Security, JSON Web Token)**
   - íšŒì›ê°€ì… ì‹œ, ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ë° ì´ë©”ì¼ ì¸ì¦ì„ í•œë‹¤. **(Redis, Jakarta Mail)**
   - ì´ë©”ì¼ ì¸ì¦ì„ í†µí•´ ì•„ì´ë””ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤. **(Redis, Jakarta Mail)**
   - ì´ë©”ì¼ ì¸ì¦ì„ í†µí•´ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆë‹¤. **(Redis, Jakarta Mail)**
   - ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
   - íšŒì› ì •ë³´ ì¡°íšŒ ë° ìˆ˜ì •ì„ í•  ìˆ˜ ìˆë‹¤.
   - ë¡œê·¸ì•„ì›ƒê³¼ íšŒì›íƒˆí‡´ë¥¼ í•  ìˆ˜ ìˆë‹¤.
   

2. ì•„í‹°ìŠ¤íŠ¸
   - ì•„í‹°ìŠ¤íŠ¸ì— ê´€í•œ ì •ë³´ë“¤ì„ ê²€ìƒ‰ ë° ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
   - ì•„í‹°ìŠ¤íŠ¸ì— ëŒ€í•œ ì¢‹ì•„ìš”ì™€ êµ¬ë…ì„ í•  ìˆ˜ ìˆë‹¤.
   - ì•„í‹°ìŠ¤íŠ¸ì— ê´€í•œ ê³µì—° ì •ë³´ ìƒì„± ì‹œ, ì´ë©”ì¼ì„ í†µí•´ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. **(Jakarta Mail)**


3. ê³µì—°
   - ê³µì—°ì„ ê²€ìƒ‰ ë° ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
   - ê³µì—°ì— ëŒ€í•œ ëŒ“ê¸€ ì‘ì„±, ì¢‹ì•„ìš”ì™€ êµ¬ë…ì„ í•  ìˆ˜ ìˆë‹¤.


4. ì¥ë¥´
   - ì¥ë¥´ì— ê´€í•œ êµ¬ë…ì„ í•  ìˆ˜ ìˆë‹¤.
   - êµ¬ë…í•œ ì¥ë¥´ë¥¼ í¬í•¨í•œ ê³µì—° ê°œì„¤ ì‹œ, ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. **(Jakarta Mail)**


5. ê²Œì‹œíŒ
   - ì¹´í…Œê³ ë¦¬ë³„(ê³µì—° í›„ê¸°, ì•„í‹°ìŠ¤íŠ¸, ììœ , ë™í–‰) ê²Œì‹œíŒì— ëŒ€í•´ CRUDë¥¼ í•  ìˆ˜ ìˆë‹¤. (ì´ë¯¸ì§€ ì—…ë¡œë“œ - AWS S3)
   - ê° ê²Œì‹œë¬¼ì— ëŒ€í•´ ëŒ“ê¸€ê³¼ ëŒ€ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. (depthëŠ” ìµœëŒ€ 1ê¹Œì§€ë‹¤.)
   - ì‘ì„±ì¼ ìˆœ, ì¡°íšŒìˆ˜ ìˆœìœ¼ë¡œ ê²Œì‹œê¸€ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
   - ì œëª©, ë‚´ìš© ê²€ìƒ‰ìœ¼ë¡œ ê²Œì‹œê¸€ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.


6. ì•„ì´í…œ & ì£¼ë¬¸ **(Toss API)**
   - ê³µì—°ë³„ ì•„ì´í…œì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
   - ê³µì—°ì— ê´€í•œ ì•„ì´í…œì„ ì£¼ë¬¸ ë° ê²°ì œí•  ìˆ˜ ìˆë‹¤.
   - ì£¼ë¬¸ ì¡°íšŒ ë° ì£¼ë¬¸ ì·¨ì†Œë¥¼ í•  ìˆ˜ ìˆë‹¤.
---

<p style="font-size: 20px">Admin</p>

1. ê´€ë¦¬ìëŠ” ì´ë©”ì¼ ì•Œë¦¼ì„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.


2. íšŒì›ê´€ë¦¬
   - ê´€ë¦¬ìëŠ” ëª¨ë“  íšŒì›ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
   - ê´€ë¦¬ìëŠ” íšŒì› ê³„ì •ì„ íƒˆí‡´ì‹œí‚¬ ìˆ˜ ìˆë‹¤.


3. ì•„í‹°ìŠ¤íŠ¸
   - ê´€ë¦¬ìëŠ” ì•„í‹°ìŠ¤íŠ¸ CRUDë¥¼ í•  ìˆ˜ ìˆìœ¼ë©°, ê²€ìƒ‰, ì¡°íšŒë¥¼ í•  ìˆ˜ ìˆë‹¤. **(ì´ë¯¸ì§€ ì—…ë¡œë“œ - AWS S3)**
   - ì•„í‹°ìŠ¤íŠ¸ ì¶”ê°€ ì‹œ, ì•„í‹°ìŠ¤íŠ¸ëª…ì„ ì¤‘ë³µ ì²´í¬í•˜ì—¬ ìƒì„±í•œë‹¤.


4. ê³µì—°
   - ê³µì—°ì— ê´€í•œ CRUDë¥¼ í•  ìˆ˜ ìˆë‹¤. **(ì´ë¯¸ì§€ ì—…ë¡œë“œ - AWS S3)**


5. ì¥ë¥´
   - ì¥ë¥´ CRUDë¥¼ í•  ìˆ˜ ìˆë‹¤.


6. ê²Œì‹œíŒ
   - ê²Œì‹œíŒ CRUDë¥¼ í•  ìˆ˜ ìˆë‹¤. 


7. ì•„ì´í…œ & ì£¼ë¬¸ **(Toss API)**
   - ì•„ì´í…œì— ëŒ€í•œ CRUDë¥¼ í•  ìˆ˜ ìˆë‹¤.
   - ì£¼ë¬¸ ì¡°íšŒ ë° ì·¨ì†Œí•  ìˆ˜ ìˆë‹¤.
---

<div align="center">

##  ğŸ‘©ğŸ»â€ğŸ’»ğŸ§‘ğŸ»â€ğŸ’» ì°¸ì—¬ì

| <img src="https://github.com/fish-minkyu/fish-minkyu/assets/128130163/05ef3683-4b2d-435c-8a07-c6712221f25b" width="120" height="160"/><br/>BE ê°•ìœ ì‹  <a href="https://github.com/simidot">GitHub</a> | <img src="https://github.com/fish-minkyu/fish-minkyu/assets/128130163/70201eec-be3a-4771-9b06-6b9a7aa2557e" width="120" height="160"/><br/>BE ê¶Œí˜ê±´ <a href="https://github.com/KwonHyeokGeon">GitHub</a> | <img src="https://github.com/fish-minkyu/fish-minkyu/assets/128130163/3f56f6a8-750f-440e-a27f-d619aa30cdbb" width="120" height="160"/><br/>BE ì–´ë¯¼ê·œ <a href="https://github.com/fish-minkyu">GitHub</a> | <img src="https://github.com/fish-minkyu/fish-minkyu/assets/128130163/2692556c-938d-4171-b798-8f0585f28452" width="120" height="160"/><br/>BE ì´ê°•ì„  <a href="https://github.com/joshiaLee">GitHub</a> |
|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|                                <strong>1ì°¨ íŒ€ì¥</strong> <br> &middot; ì¥ë¥´ CRUD <br> &middot; ì•„í‹°ìŠ¤íŠ¸CRUD <br> &middot; í”„ë¡ íŠ¸ <br> &middot; Amazon S3 <br> &middot; ì´ë©”ì¼ ì•Œë¦¼                                 |                                       <strong>íŒ€ì›</strong> <br> &middot;ê³µì—° CRUD <br> &middot; í”„ë¡ íŠ¸ <br> &middot; AWS CI/CD <br> &middot; Grafana & Prometheus ëª¨ë‹ˆí„°ë§                                        |                                            <strong>íŒ€ì›</strong> <br> &middot; ê²Œì‹œê¸€ CRUD <br> &middot; í”„ë¡ íŠ¸ <br> &middot; nGrinder ë¶€í•˜ í…ŒìŠ¤íŠ¸ <br> &middot; NCP ë°°í¬                                            |                     <strong>2ì°¨ íŒ€ì¥</strong> <br> &middot; íšŒì›ê°€ì… & ë¡œê·¸ì¸ <br> &middot; í”„ë¡ íŠ¸ <br> &middot; Toss API <br> &middot; ì´ë©”ì¼ ì¸ì¦ <br> &middot; í¬ë¡¤ë§ <br> &middot; Kubernetes ë°°í¬                     |

</div>


##  âš ï¸ ëŒ€í‘œ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

<details>
<summary><strong>ì•Œë¦¼ ì„œë¹„ìŠ¤ êµ¬í˜„í•˜ê¸°</strong></summary>


# 1. ì•Œë¦¼ ì„œë¹„ìŠ¤ êµ¬í˜„í•˜ê¸°

### ğŸ–¥ï¸ ìƒí™©

- ì‚¬ìš©ìëŠ” ì•„í‹°ìŠ¤íŠ¸ì™€ ì¥ë¥´ì— ëŒ€í•´ êµ¬ë…í•  ìˆ˜ ìˆë‹¤.
- ìƒˆë¡œìš´ ê³µì—° ì •ë³´ê°€ ì—…ë¡œë“œë  ë•Œ ì‚¬ìš©ìê°€ êµ¬ë…í•œ ì•„í‹°ìŠ¤íŠ¸ê°€ ì°¸ì—¬í•˜ê±°ë‚˜, ì‚¬ìš©ìê°€ êµ¬ë…í•œ ì¥ë¥´ì˜ ê³µì—°ì´ë¼ë©´ ì‚¬ìš©ìì—ê²Œ ì´ë©”ì¼ë¡œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
- ì´ë•Œ, ì´ë©”ì¼ ì•Œë¦¼ì€ **Jakarta Mail**ë¡œ ë©”ì¼ ë°œì†¡ ì²˜ë¦¬ë¥¼ í•˜ëŠ”ë°, ê³µì—° ì •ë³´ë¥¼ ì—…ë¡œë“œí•˜ëŠ” ë©”ì„œë“œ ë‚´ë¶€ì— êµ¬í˜„í•´ì•¼í• ì§€? êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í• ì§€ ê³ ë¯¼ì´ ë˜ì—ˆë‹¤.

### ğŸ–‹ï¸ ì•Œë¦¼ ì²˜ë¦¬ì— ëŒ€í•œ ê³µë¶€

**1) Spring ë¹„ë™ê¸° ì²˜ë¦¬ ê¸°ëŠ¥**


: ì•Œë¦¼ ì‘ì—…ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ì‘ë‹µ ì‹œê°„ì„ ìµœì†Œí™”í•  ìˆ˜ ìˆë‹¤.

- @EnableAsync + @Async : ë‹¨ìˆœí•œ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
- SpringAsyncConfig(@EnableAsync) + @Async(â€threadPoolNameâ€) : ìŠ¤ë ˆë“œ í’€ì„ ë§Œë“ ë‹¤.
- ë¦¬í„´ ê°’ì´ ìˆëŠ” ê²½ìš° : Future, ListenableFuture, CompleatableFuture ì‚¬ìš©
- ğŸ‘ğŸ» : ë†’ì€ ì‘ë‹µì„±, ìì› íš¨ìœ¨ì„± (í•„ìš”ì— ë”°ë¼ ìŠ¤ë ˆë“œ ìƒì„± ë° ê´€ë¦¬)
- ğŸ‘ğŸ» : ì½”ë“œ ë³µì¡ë„, ë©”ëª¨ë¦¬ ë¬¸ì œ (ìŠ¤ë ˆë“œê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì™€ ë™ì¼í•œ ë©”ëª¨ë¦¬ ê³µê°„ì„ ê³µìœ í•œë‹¤)

**2) ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜**


: ê³µì—° ì •ë³´ê°€ ì—…ë¡œë“œë˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ê³ , í•´ë‹¹ ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•˜ëŠ” ì•Œë¦¼ ì„œë¹„ìŠ¤ê°€ ê°ì§€í•˜ì—¬ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.

- Springì˜ ì´ë²¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì‚¬ìš© + ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¦¬ìŠ¤ë„ˆ ë“±ë¡
- ì´ë²¤íŠ¸ ë°œí–‰ : ApplicationEventPublisher ì£¼ì…ë°›ì•„ ì‚¬ìš©
- ì´ë²¤íŠ¸ êµ¬ë… : ApplicationListener ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ í˜¹ì€ @EventListener ì‚¬ìš©
- ë©€í‹° ìºìŠ¤íŒ… ê´€ê³„ : ë‹¤ìˆ˜ì˜ ìˆ˜ì‹ ìê°€ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” í†µì‹  í˜•íƒœ
- ë™ê¸° ë°©ì‹ìœ¼ë¡œ ë™ì‘ (íŠ¸ëœì­ì…˜ì´ í•˜ë‚˜ì˜ ë²”ìœ„ë¡œ ë¬¶ì¼ ìˆ˜ ìˆë‹¤.)
- ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ í•˜ê¸° ìœ„í•´ì„œëŠ” ë³„ë„ì˜ ì„¤ì •ì´ í•„ìš”
   - @Async ë©”ì„œë“œë¡œ ë¹„ë™ê¸° êµ¬í˜„
   - ApplicationEventMulticasterë¡œ ë¹„ë™ê¸° êµ¬í˜„
- ğŸ‘ğŸ» : ì˜ì¡´ì„± ë¶„ë¦¬, ì¬ì‚¬ìš©ì„±, ë³„ë„ì˜ ì„œë¹„ìŠ¤ ë¶„ë¦¬ ìš©ì´ (ì—¬ëŸ¬ ë„ë©”ì¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥), ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ìš©ì´
- ğŸ‘ğŸ» : ì „ë°˜ì ì¸ ì‘ì—…ëŸ‰ì´ ë§ì•„ì§. ë©”ì‹œì§€ êµ¬ë… ìˆœì„œë¥¼ ê³ ë ¤í•´ì•¼ í•˜ëŠ” ê²½ìš° ë³µì¡.

**3) ì•Œë¦¼ ëŒ€ê¸°ì—´**


: ë©”ì‹œì§€ íë‚˜ ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì„ì‹œ ì €ì¥í•˜ê³ , ëŒ€ê¸°ì—´ì„ ì •ê¸°ì ìœ¼ë¡œ í™•ì¸í•˜ì—¬ ì•Œë¦¼ì„ ë°œì†¡í•˜ëŠ” ë°©ì‹.

- RabbitMQ ì‚¬ìš© (AMQP(Advanced Message Queuing Protocol)ì„ êµ¬í˜„í•œ ì˜¤í”ˆ ì†ŒìŠ¤ ë©”ì‹œì§€ ë¸Œë¡œì»¤)
- Amazon SQS (Simple Queue Service) ì‚¬ìš©
- Apache Kafka ì‚¬ìš© (ê³ ì„±ëŠ¥, ë¶„ì‚°í˜• ìŠ¤íŠ¸ë¦¬ë° í”Œë«í¼. ëŒ€ëŸ‰ì˜ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì— íŠ¹í™”)
- RabbitMQ ì‚¬ìš© (AMQP(Advanced Message Queuing Protocol)ì„ êµ¬í˜„í•œ ì˜¤í”ˆ ì†ŒìŠ¤ ë©”ì‹œì§€ ë¸Œë¡œì»¤)
- ActiveMQ ì‚¬ìš©
- ğŸ‘ğŸ» : í™•ì¥ì„±, ê²°í•©ë„ ê°ì†Œ, ë¶€í•˜ ë¶„ì‚°
- ğŸ‘ğŸ» : ë³µì¡ì„± ì¦ê°€, ë””ë²„ê¹…ê³¼ ëª¨ë‹ˆí„°ë§ì˜ ì–´ë ¤ì›€

### **ğŸŒŸ ì„ íƒ**

- 2ë²ˆê³¼ 3ë²ˆì€ í˜„ì¬ ìƒí™©ì—ì„œ ì‹œê°„ì  ì—¬ìœ  ë° ê²½í—˜ ë¶€ì¡±ìœ¼ë¡œ êµ¬í˜„ì´ ì–´ë ¤ìš¸ ê²ƒìœ¼ë¡œ ì˜ˆìƒ.
- ê·¸ëŸ¬ë‚˜, ë¹„ë™ê¸° ì²˜ë¦¬ëŠ” í•„ìˆ˜ì´ë¯€ë¡œ 1ë²ˆ ë°©ë²•ì„ í™œìš©í•´ ì•Œë¦¼ ì²˜ë¦¬ë¥¼ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ê¸°ë¡œ í–ˆë‹¤.
- í•µì‹¬ : ì•Œë¦¼ ì²˜ë¦¬ê°€ ì§€ì—°ë˜ì–´ë„ ê³µì—° ì •ë³´ ì—…ë¡œë“œ ìš”ì²­ì€ ì™„ë£Œë˜ì–´ì•¼ í•˜ë©°, ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì•Œë¦¼ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ì—¬ì•¼ í•œë‹¤.

### ğŸ“¨ êµ¬í˜„

**1) AsyncConfig ì„¤ì •**

- @EnableAsync : ë¹„ë™ê¸° ê¸°ëŠ¥ í™œì„±
- TaskExecutorë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì‘ì—…ì„ ìŠ¤ì¼€ì¤„ë§ (ThreadPoolTaskExecutor)
- setCorePoolSize(n) : ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤í–‰ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ ê°œìˆ˜
- setMaxPoolSize(n) : ë™ì‹œì— ë™ì‘í•˜ëŠ” ìµœëŒ€ ìŠ¤ë ˆë“œ ê°œìˆ˜
- setQueueCapacity(n) : CorePoolì˜ í¬ê¸°ë¥¼ ë„˜ì–´ì„œë©´ íì— ì €ì¥í•˜ëŠ”ë°, ê·¸ íì˜ ìµœëŒ€ ìš©ëŸ‰

```java
@Configuration
@EnableAsync // ìŠ¤í”„ë§ì˜ ë¹„ë™ê¸° ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ì—¬ Async ì–´ë…¸í…Œì´ì…˜ì„ ê°ì§€
public class AsyncConfig implements AsyncConfigurer {

  @Override
  @Bean(name = "threadPoolTaskExecutor")
  public Executor getAsyncExecutor() {
		// ë‚´ PCì˜ Processor ê°œìˆ˜ë¥¼ ê°€ì ¸ì˜´.
    int processors = Runtime.getRuntime().availableProcessors(); 
	  // TaskExecutorë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì‘ì—…ì„ ìŠ¤ì¼€ì¤„ë§ (ThreadPoolTaskExecutor)
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); 
    // ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤í–‰ ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ ê°œìˆ˜
    executor.setCorePoolSize(processors);
    // ë™ì‹œì— ë™ì‘í•˜ëŠ” ìµœëŒ€ ìŠ¤ë ˆë“œ ê°œìˆ˜
    executor.setMaxPoolSize(processors * 2); 
    // CorePoolì˜ í¬ê¸°ë¥¼ ë„˜ì–´ì„œë©´ íì— ì €ì¥í•˜ëŠ”ë°, ê·¸ íì˜ ìµœëŒ€ ìš©ëŸ‰
    executor.setQueueCapacity(50); // ëŒ€ê¸°ë¥¼ ìœ„í•œ Queue í¬ê¸°
    executor.setKeepAliveSeconds(60);  // ìŠ¤ë ˆë“œ ì¬ì‚¬ìš© ì‹œê°„
    executor.setThreadNamePrefix("AsyncExecutor-"); // ìŠ¤ë ˆë“œ ì´ë¦„ prefix
    executor.initialize(); // ThreadPoolExecutor ìƒì„±

    return executor;
  }
}
```

**2) ë¹„ë™ê¸° ì ìš©**


: ë¹„ë™ê¸° ì²˜ë¦¬ ë©”ì„œë“œì— @Async ì–´ë…¸í…Œì´ì…˜ ë¶™ì—¬ì£¼ê¸°

```java
    // ì´ë©”ì¼ ë°œì†¡ ë©”ì„œë“œ
    @Override
    @Async("threadPoolTaskExecutor")
    @Transactional
    public void sendMail(Alert alert) throws MessagingException {
        log.info("===== email sending start");

        MimeMessage message = mailSender.createMimeMessage();
        MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

        helper.setSubject(EMAIL_TITLE_PREFIX + alert.getTitle()); //ì œëª©
        helper.setFrom("stage alarm <noreply@stagealarm.com>");
        helper.setTo(alert.getUserEmail());
        HashMap<String, String> emailValues = new HashMap<>();
        emailValues.put("content", alert.getMessage());
        String text = setContext(emailValues);
        helper.setText(text, true);
        helper.addInline("logo", new ClassPathResource("static/images/logo.png"));
        helper.addInline("notice-icon", new ClassPathResource("static/images/image-1.png"));

        mailSender.send(message);
        log.info("===== email sending end");
    }

```

```java
    // ê³µì—° ì •ë³´ì— ëŒ€í•œ ì•Œë¦¼ ê°ì²´ ìƒì„± ë©”ì„œë“œ (ë‚´ë¶€ì—ì„œ ì´ë©”ì¼ ë°œì†¡ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ í–ˆë‹¤)
    @Override
    @Async("threadPoolTaskExecutor")
    @Transactional
    public void createAlert(Long showInfoId) {
        // í•´ë‹¹ ê³µì—°ì •ë³´ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ ê´€ë ¨ ì•Œë¦¼ ê°ì²´ ìƒì„±
        log.info("===== artist alert creation start");
        List<ShowArtist> showArtists = showArtistRepo.findByShowInfoId(showInfoId);
        generateArtistSubAlert(showArtists);
        log.info("===== artist alert creation end");

        log.info("===== genre alert creation start");
        List<ShowGenre> showGenres = showGenreRepo.findByShowInfoId(showInfoId);
        generateGenreSubAlert(showGenres);
        log.info("===== genre alert creation end");

        List<Alert> alerts = alertRepository.findByShowInfoId(showInfoId);
        for (Alert alert : alerts) {
            try {
                log.info("send email start");
                alert.setMessage(generateMessage(alert, alert.getUserNickname()));
                sendMail(alert);
            } catch (MessagingException e) {
                log.warn(e.getMessage());
                throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR);
            }
        }
    }
```

**** ì£¼ì˜ì‚¬í•­ ****

- @Async ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì„œë“œëŠ” ê°™ì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ ë‹¤ë¥¸ ë©”ì„œë“œê°€ ì§ì ‘ í˜¸ì¶œí•  ê²½ìš° ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. ìŠ¤í”„ë§ì˜ **í”„ë¡ì‹œ ê¸°ë°˜ AOP**ê°€ ì‘ë™í•˜ëŠ” ë°©ì‹ ë•Œë¬¸ì´ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ìê¸° ìì‹ ì˜ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•˜ê±°ë‚˜, ë‹¤ë¥¸ ë¹ˆì—ì„œ í•´ë‹¹ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤.
- ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” AsyncUncaughtExceptionHandlerë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.

### ğŸ”¥ íŠ¸ëŸ¬ë¸” ë°œìƒ

![ì´ë¯¸ì§€](https://prod-files-secure.s3.us-west-2.amazonaws.com/c69962b0-3951-485b-b10a-5bb29576bba8/f8205c6e-8ae7-4707-afa6-421651e436cf/Untitled.png)

- ì°¾ì•„ë´¤ë”ë‹ˆ ìŠ¤í”„ë§ì€ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•´ì„œ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ Async ì²˜ë¦¬ëœ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•  ë•Œ í”„ë¡ì‹œ ê¸°ìˆ ì„ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤. ìŒ... í”„ë¡ì‹œê°€ ë­”ë° ëŒ€ì²´!....
- í”„ë¡ì‹œ ìƒì„± ë°©ë²•ì—ëŠ” JDK ë™ì  í”„ë¡ì‹œ / CGLib ì‚¬ìš© ê°€ëŠ¥
- ìŠ¤í”„ë§ ë¶€íŠ¸ ì‚¬ìš©ì‹œì—ëŠ” AOP ì ìš©ì‹œ ê¸°ë³¸ìœ¼ë¡œ CGLib ì‚¬ìš©
- @EnableAsyncëŠ” ìŠ¤í”„ë§ë¶€íŠ¸ì˜ ë°©ì‹ê³¼ëŠ” ë¬´ê´€í•˜ê²Œ **JDK ë™ì  í”„ë¡ì‹œë‚˜ CGLib** ì¤‘ ì„ íƒ ê°€ëŠ¥í•˜ë‹¤. (ê¸°ë³¸ê°’ì´ Jdk ë™ì  í”„ë¡ì‹œ)

<details>
<summary><strong>AOP Proxy ê´€ë ¨ ê°„ë‹¨ ì„¤ëª…</strong></summary>

**1. JDK dynamic proxy**


:ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ì˜ í”„ë¡ì‹œ ìƒì„± ë°©ì‹. Javaì˜ ë¦¬í”Œë ‰ì…˜ì„ ì´ìš©í•´ì„œ ê°ì²´ë¥¼ ë§Œë“ ë‹¤.

ëŒ€ìƒì˜ ê°ì²´ê°€ ìµœì†Œ í•˜ë‚˜ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤ë©´ JDK í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•œë‹¤.

ìŠ¤í”„ë§ì€ JDKì˜ Proxyí´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±.

ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ í”„ë¡ì‹±ì— ì í•©í•˜ë‹¤.

**2. CGLib proxy (Code Generation Library)**


: í´ë˜ìŠ¤ ê¸°ë°˜ì˜ í”„ë¡ì‹œ ìƒì„± ë°©ì‹.Â ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“ ë‹¤.  
ëŒ€ìƒ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šê±°ë‚˜, proxyTargetClass=true ì„¤ì •ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— ì ìš©ëœë‹¤.  
ìƒì†ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒ í´ë˜ìŠ¤ì˜ í•˜ìœ„ í´ë˜ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³ , ì´ë¥¼ í†µí•´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“ ë‹¤.  
í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ìƒì†í•˜ì—¬ í”„ë¡ì‹±í•œë‹¤.

**default** : JDK dynamic proxy

ë§Œì•½ **@EnableAsync(proxyTargetClass =true)** ì„¤ì •ì„ í•˜ì˜€ìœ¼ë©´ **CGLib** proxy ê°•ì œ

</details>


ğŸ¤”ì‚¬ì‹¤ í”„ë¡ì‹œì— ëŒ€í•´ ì œëŒ€ë¡œ ê³µë¶€í•˜ì§€ ì•Šê³ , ê·¸ëƒ¥ ì–´ì°Œì €ì°Œ í•´ê²°í•˜ë‹¤ë³´ë‹ˆ ì‹¤í–‰ì´ ë˜ì—ˆë‹¤.  
ì´ë•Œ í•´ê²°ì±…ìœ¼ë¡œ ì¼ë˜ ê²ƒì€ **@EnableAsync(proxyTargetClass=true)**ë¡œ ë°”ê¾¸ê³ , ëœë‹¤! í•˜ê³  ì•„ë¬´ ìƒê° ì—†ì´ ë„˜ê²¼ë‹¤.  
í•˜ì§€ë§Œ, ì§€ê¸ˆ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì„ ì ìœ¼ë©° í”„ë¡ì‹œì— ëŒ€í•´ì„œ ì–´ëŠì •ë„ ê°œë…ì„ ê³µë¶€í•˜ë‹ˆ, ì–¼ë–¨ê²°ì—~ í•´ê²°í–ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ì—ˆë‹¤.  

ìœ„ì˜ ì˜¤ë¥˜ ìƒí™©ì„ ì œëŒ€ë¡œ ì‚´í´ë³´ë©´ Actionì— ë‘ê°€ì§€ í•´ê²°ì±…ì„ ì œì‹œí•´ì£¼ì—ˆë‹¤.

1) Consider injecting the bean as one of its interfaces

or

2) forcing the use of CGLib-based proxies by setting proxyTargetClass=true on @EnableAsync and/or @EnableCaching.

ì´ë ‡ê²Œ ë‘ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

1) ì¸í„°í˜ì´ìŠ¤ ìƒì†ì„ í†µí•´ì„œ ë¹ˆ ì£¼ì…ì„ í•˜ì—¬ JDK dynamic proxyë¡œ ì œëŒ€ë¡œ ìƒì„±ë˜ê²Œ ë§Œë“ ë‹¤.

2) proxyTargetClass=true ì„¤ì •ì„ í†µí•´ì„œ CGLib proxyë¡œ ê°•ì œí•˜ì—¬ ìƒì„±ë˜ê²Œ ë§Œë“ ë‹¤.

ìœ„ì˜ ìƒí™©ì—ì„œ ë‚˜ëŠ” ë¶„ëª… interfaceë¥¼ êµ¬í˜„í•˜ê³  ìƒì†ë°›ì•˜ëŠ”ë° ì™œ why? ì´ëŸ° ë¬¸ì œê°€ ë‚˜ëŠ”ê±¸ê¹Œ ? í–ˆëŠ”ë°,  
ì•Œê³ ë³´ë‹ˆ, Async ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë¦¬ëŠ” ë©”ì„œë“œê°€ ê¼­ ë°˜ë“œì‹œ ì¸í„°í˜ì´ìŠ¤ì— êµ¬í˜„ë˜ì–´ìˆì–´ì•¼ í•œë‹¤. = ì¸í„°í˜ì´ìŠ¤ë¡œ ë¹ˆì„ ì£¼ì…í•œë‹¤.   
ê·¸ë˜ì„œ ë‘ê°€ì§€ ë©”ì„œë“œë¥¼ ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œë¡œ êµ¬í˜„í•˜ì—¬ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬ êµ¬ì²´ì ì¸ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì£¼ì—ˆë‹¤.

```java
public interface AlertService {
    void createAlert(Long showInfoId);
    void sendMail(Alert alert) throws MessagingException;
}
```

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class EmailAlertService implements AlertService {
    private final JavaMailSender mailSender;
    private final SpringTemplateEngine templateEngine;

    private final AlertRepository alertRepository;
    private final ShowArtistRepo showArtistRepo;
    private final ShowGenreRepo showGenreRepo;
    private final GenreSubscribeRepo genreSubscribeRepo;
    private final ArtistSubscribeRepo artistSubscribeRepo;

    private static final String EMAIL_TITLE_PREFIX = "[STAGE ALARM] ì•Œë¦¼ : ìƒˆ ê³µì—°ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤";
    private static final String EMAIL_ALARM_TITLE = "ì•Œë¦¼ : ìƒˆ ê³µì—°ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤";

    @Override
    @Async("threadPoolTaskExecutor")
    public void sendMail(Alert alert) throws MessagingException {
        log.info("===== email sending start");

        MimeMessage message = mailSender.createMimeMessage();
        MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

        helper.setSubject(EMAIL_TITLE_PREFIX + alert.getTitle()); //ì œëª©
        helper.setFrom("stage alarm <noreply@stagealarm.com>");
        helper.setTo(alert.getUserEmail());
        HashMap<String, String> emailValues = new HashMap<>();
        emailValues.put("content", alert.getMessage());
        String text = setContext(emailValues);
        helper.setText(text, true);
        helper.addInline("logo", new ClassPathResource("static/images/logo.png"));
        helper.addInline("notice-icon", new ClassPathResource("static/images/image-1.png"));

        mailSender.send(message);
        log.info("===== email sending end");
    }

    @Override
    public void createAlert(Long showInfoId) {
        // í•´ë‹¹ ê³µì—°ì •ë³´ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ ê´€ë ¨ ì•Œë¦¼ ê°ì²´ ìƒì„±
        log.info("===== artist alert creation start");
        List<ShowArtist> showArtists = showArtistRepo.findByShowInfoId(showInfoId);
        generateArtistSubAlert(showArtists);
        log.info("===== artist alert creation end");

        log.info("===== genre alert creation start");
        List<ShowGenre> showGenres = showGenreRepo.findByShowInfoId(showInfoId);
        generateGenreSubAlert(showGenres);
        log.info("===== genre alert creation end");

        List<Alert> alerts = alertRepository.findByShowInfoId(showInfoId);
        for (Alert alert : alerts) {
            try {
                log.info("send email start");
                alert.setMessage(generateMessage(alert, alert.getUserNickname()));
                sendMail(alert);
            } catch (MessagingException e) {
                log.warn(e.getMessage());
                throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR);
            }
        }
    }

    private void generateArtistSubAlert(List<ShowArtist> shows) {
        for (ShowArtist artist : shows) {
            List<ArtistSubscribe> subscribes = artistSubscribeRepo.findByArtistId(artist.getArtist().getId());
            for(ArtistSubscribe subscribe : subscribes) {
                log.info("subscribe :: "+subscribe.toString());
                Alert alert = Alert.builder()
                    .showInfo(artist.getShowInfo())
                    .userEmail(subscribe.getUserEntity().getEmail())
                    .userNickname(subscribe.getUserEntity().getNickname())
                    .artistSubscribe(subscribe)
                    .title(EMAIL_ALARM_TITLE)
                    .build();

                alert = alertRepository.save(alert);
                log.info("saved..artist alert : "+alert.toString());
            }
        }
    }

    private void generateGenreSubAlert(List<ShowGenre> shows) {
        for (ShowGenre genre : shows) {
            List<GenreSubscribe> subscribes = genreSubscribeRepo.findByGenreId(genre.getGenre().getId());
            for (GenreSubscribe subscribe : subscribes) {
                String userEmail = subscribe.getUserEntity().getEmail();
                Optional<Alert> alertOptional = alertRepository.findByUserEmailAndShowInfoId(userEmail, genre.getShowInfo().getId());
                Alert alert;
                // ì´ë¯¸ í•´ë‹¹ êµ¬ë…ì ìœ ì €ì— ëŒ€í•œ ì•Œë¦¼ì´ ìƒì„±ëœ ìƒíƒœì´ë©´ ì´ë¯¸ ìƒì„±ëœ alertì— ì¶”ê°€ë§Œ í•˜ê³  ì•Œë¦¼ ì´ë©”ì¼ì€ ë³´ë‚´ì§€ ì•ŠìŒ
                if (alertOptional.isPresent()) {
                    alert = alertOptional.get();
                    alert.setGenreSubscribe(subscribe);
                    alertRepository.save(alert);
                    log.info("==== set same alert for " + subscribe.getUserEntity().getNickname());
                    continue;
                } else { // í•œ ìœ ì €ì— ëŒ€í•œ ì•Œë¦¼ì´ ìƒì„±ë˜ì§€ ì•Šì€ ìƒíƒœì´ë©´ ìƒˆë¡œ ìƒì„±
                    alert = Alert.builder()
                        .showInfo(genre.getShowInfo())
                        .genreSubscribe(subscribe)
                        .title(EMAIL_ALARM_TITLE)
                        .userEmail(userEmail)
                        .userNickname(subscribe.getUserEntity().getNickname())
                        .build();
                    alertRepository.save(alert);
                }
                log.info("saved..genre alert : "+alert.toString());
            }
        }
    }

    private String generateMessage(Alert alert, String userNickname){
        StringBuffer sb = new StringBuffer();
        sb.append("ì•ˆë…•í•˜ì„¸ìš”. ").append(userNickname).append("ë‹˜, ìŠ¤í…Œì´ì§€ ì•ŒëŒì—ì„œ ì•Œë¦¼ ë“œë¦½ë‹ˆë‹¤.   \n");
        sb.append("êµ¬ë…í•˜ì‹  ");
        if (alert.getGenreSubscribe() != null && alert.getArtistSubscribe()!=null) {
            sb.append("ì•„í‹°ìŠ¤íŠ¸ :: ").append(alert.getArtistSubscribe().getArtist().getName()).append("ì™€ ");
            sb.append("ì¥ë¥´ :: ").append(alert.getGenreSubscribe().getGenre().getName()).append("ì˜ ê³µì—° ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.  \n");
        } else if (alert.getGenreSubscribe() == null) {
            sb.append("ì•„í‹°ìŠ¤íŠ¸ :: ").append(alert.getArtistSubscribe().getArtist().getName()).append("ì˜ ê³µì—° ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.  \n");
        } else {
            sb.append("ì¥ë¥´ :: ").append(alert.getGenreSubscribe().getGenre().getName()).append("ì˜ ê³µì—° ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.  \n");
        }
        sb.append("í•´ë‹¹ ê³µì—° ë³´ê¸° : ").append(alert.getShowInfo().getTicketVendor()).append(" \n\n");
        sb.append("ì €í¬ ìŠ¤í…Œì´ì§€ ì•ŒëŒì„ ì‚¬ë‘í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ");

        return sb.toString();
    }

    private String setContext(Map<String, String> emailValues) {
        Context context = new Context();
        emailValues.forEach(context::setVariable);
        return templateEngine.process("email/index.html", context);
    }
}
```

### **ğŸ“¨ğŸ“¨ğŸ“¨ ê²°ê³¼ ë¡œê·¸**

![ì´ë¯¸ì§€](https://blog.kakaocdn.net/dn/bfPIJL/btsGjBmkAJl/gWT8y1cZNSaIbaBakKhq4K/img.png)

1) ê³µì—° ì •ë³´ ì—…ë¡œë“œì‹œ uploadIntoS3 í•˜ê³ ,

2) í•´ë‹¹ ê³µì—° ì •ë³´ì— ëŒ€í•´ì„œ ì €ì¥ì„ í•˜ê³ ,

3) ì´ ìƒì„±ëœ ShowInfo ê°ì²´ë¥¼ ê°€ì§€ê³  ê´€ë ¨ ShowArtist, ShowGenre ê°ì²´ë¥¼ ìƒì„±í•´ì£¼ê³ 

4) ì´ë¥¼ í™œìš©í•´ êµ¬ë…ìì™€ ShowArtist, ShowGenre ì—°ê²°ì§“ëŠ” Alert ê°ì²´ë¥¼ ë§Œë“¤ì–´ì£¼ê³ 

5) ì´ ë§Œë“¤ì–´ì§„ Alertë¥¼ ë°”íƒ•ìœ¼ë¡œ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°œì†¡í•œë‹¤. (ì´ë•Œ í™•ì¸í•˜ê³  ì¤‘ë³µë˜ê²Œ ì•Œë¦¼ì´ ë³´ë‚´ì§€ì§€ ì•ŠëŠ”ë‹¤)

6) ê·¸ë ‡ê²Œ ì•Œë¦¼ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì°¨ë¡€ë¡œ ì²˜ë¦¬ê°€ ë˜ê³  ì´í›„ ìŠ¤ë ˆë“œê°€ ë‹«íŒë‹¤.

### **ğŸŒŸğŸŒŸë™ê¸° ì²˜ë¦¬ ë°©ì‹ vs. ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹ ğŸŒŸğŸŒŸ**

ë™ê¸° ì²˜ë¦¬ì™€ ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì°¨ì´ë¥¼ ëŠê»´ë³´ê³ ì ì‹¤í—˜ì„ í–ˆë‹¤.  
5ëª…ì˜ êµ¬ë…ìì—ê²Œ ì´ë©”ì¼ì„ ë°œì†¡í•˜ì˜€ë‹¤.

![ì´ë¯¸ì§€](https://blog.kakaocdn.net/dn/cY7T0x/btsF9CrHfsR/rT4VZJktcKGv5KYcRBwkI0/img.png)

![ì´ë¯¸ì§€](https://blog.kakaocdn.net/dn/dxltzM/btsGkULXTuF/N0ftzCOWxSErvyqkmSUVc0/img.png)

1) ë™ê¸° ì²˜ë¦¬ ë°©ì‹ : ê³µì—°ì •ë³´ ì—…ë¡œë“œ ìš”ì²­ì‹œ 5ëª…ì˜ êµ¬ë…ìì—ê²Œ ì´ë©”ì¼ì„ ëª¨ë‘ ë°œì†¡í•˜ëŠ” ì‹œê°„ê¹Œì§€ ë”í•´ì ¸ **15.37s ê¸°ë¡**

2) ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹ : ê³µì—°ì •ë³´ ì—…ë¡œë“œ ìš”ì²­ì‹œ **439ms ê¸°ë¡**, ìš”ì²­ ë³´ë‚¸ í›„ì— ì´ë©”ì¼ ì „ì†¡ì´ ì°¨ë¡€ë¡œ ì´ë£¨ì–´ì§€ê³ , ì´ë©”ì¼ ì „ì†¡ì´ ì´ë£¨ì–´ì§€ëŠ” ì‚¬ì´ì—ë„ ì—¬ëŸ¬ë²ˆ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

[ì•Œë¦¼ ë™ê¸°ì²˜ë¦¬ì™€ ë¹„ë™ê¸°ì²˜ë¦¬](https://www.notion.so/4d6c075d3db94bb0a957c201b40fbd80?pvs=21) <<ë™ì˜ìƒ

</details>

<details>
<summary><strong>ê²Œì‹œê¸€ ìƒì„¸ì •ë³´ ë° ëŒ“ê¸€ì„ getìš”ì²­í•  ë•Œ ì•„ë˜ì˜ ì—ëŸ¬ë°œìƒ</strong></summary>

## ğŸƒê²Œì‹œê¸€ ìƒì„¸ì •ë³´ ë° ëŒ“ê¸€ì„ get ìš”ì²­ í•  ë•Œ ì•„ë˜ì˜ ì—ëŸ¬ë°œìƒ

![](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/64d77117-81ea-4301-a78b-f2ef891de2e5/Untitled.png?id=2cc1bcd8-e589-4e08-b3a8-22f1ae0d9dd5&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712340000000&signature=zBb1AMarSPo6Z7DfzuFqApGPfAF6Dh4CUijWQEDF7oc&downloadName=Untitled.png)

![Untitled](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/3d1d45ad-cb28-4d2f-9eed-2900a5397cfe/Untitled.png?id=66926217-f464-4282-a9cf-d4d5a0756ddc&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712340000000&signature=QyX0ThsxbQfFJJS6TG2B8jQ_5mzLHeW3zjnedvzOeuA&downloadName=Untitled.png)

- FetchType.LAZYë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•Œ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ ëª¨ë‘ ë¡œë”©ë˜ì§€ ì•Šê³  í•„ìš”ë¡œ í•  ë•Œ ë¡œë”©í•¨.
- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¡œë”©ë˜ì§€ ì•Šì€ ëŒ€ì‹  í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•¨.
- Dtoê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì§ë ¬í™”í•  ë•Œ í•´ë‹¹ ê°ì²´ì˜ ëª¨ë“  í•„ë“œëŠ” ì™„ì „í•˜ê²Œ ì´ˆê¸°í™”ë˜ì–´ì•¼í•¨.
  ê·¸ëŸ¬ë‚˜ í”„ë¡ì‹œ ê°ì²´ë¡œ ë¡œë”©ëœ ê°ì²´ëŠ” ì§ë ¬í™”ê³¼ì •ì—ì„œ ì‹¤ì œë¡œ ì´ˆê¸°í™”ë˜ì§€ì•ŠìŒ.
- Jacksonì´ JSONìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë™ì•ˆ í”„ë¡ì‹œ ê°ì²´ì˜ í•„ë“œë¥¼ ì ‘ê·¼í•˜ë ¤ í•  ë•Œ ì—ëŸ¬ê°€ ë°œìƒ!

![Untitled](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/506ae3e7-bcd6-4db2-9077-54f6fe210c0d/Untitled.png?id=55d49c17-c8bc-4e0c-b440-80866d1deff8&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712347200000&signature=NgS36Dc-P2Wot_TURRjKoqfK6G7H6wh-uNMBCl8BNhQ&downloadName=Untitled.png)

> showInfoì™€ userEntityê°€ lazyloadingë¨


![Untitled](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/cc608b16-649b-4df0-9371-1ea55b0d1f2a/Untitled.png?id=76beb725-cb6a-4f85-8fdb-dbbe9b1200eb&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712347200000&signature=TjrqhPNTW1whbx6Eq1lybLIRLyNUEMIn5tIk1OUjKBQ&downloadName=Untitled.png)

## í•´ê²°ë°©ë²•

ì—”í‹°í‹° ëŒ€ì‹  DTOë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ë³´ë¥¼ ì§ë ¬í™”í•˜ë©´ ëœë‹¤.

![Untitled](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/994074b9-e1b7-4897-8228-3bd26e627db6/Untitled.png?id=5ff44461-ab12-4145-bd21-37a9aca966f8&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712347200000&signature=ZlROsu8Sy2O5EWKOoUx7W1Gsf514etjGmJ8hF_VvoXY&downloadName=Untitled.png)

- UserEntityë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  UserResponseDtoë¥¼ ì‚¬ìš©í•˜ì—¬ showCommentsì˜ getUserEntity()ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
   - DTOë¡œ ë³€í™˜í•  ë•Œ í•„ìš”í•œ ë°ì´í„°ë§Œì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— í”„ë¡ì‹œ ê°ì²´ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë¡œë”©í•  í•„ìš”ê°€ ì—†ì–´ì„œ í”„ë¡ì‹œê°ì²´ì˜ ì´ˆê¸°í™”ë¥¼ ê°•ì œë¡œ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ.

```java
@Getter
@Setter
@Builder
@ToString
@NoArgsConstructor
@AllArgsConstructor
public class UserResponseDto {
    // commentsì— getìš”ì²­ì´ ì™”ì„ ë•Œ userì •ë³´ë¥¼ ì£¼ê¸° ìœ„í•œ userDto(userEntityë¥¼ ì§ì ‘ ë„˜ê¸°ì§€ ì•Šê¸° ìœ„í•´)
    private String nickname;
    private Long userId;
    private String authorities;

    public static UserResponseDto fromEntity(UserEntity user) {
        if (user == null) return null;
        return UserResponseDto.builder()
                .nickname(user.getNickname())
                .userId(user.getId())
                .authorities(user.getAuthorities())
                .build();
    }
}

```

Rest APIë¥¼ í†µí•´ ì‘ë‹µë°›ì€ DTOë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™”í•˜ëŠ” ê³¼ì •ì—ì„œ ìƒê°ì¹˜ë„ ëª»í–ˆë˜ ì—ëŸ¬ê°€ ë§ì´ ë°œìƒí–ˆë‹¤.  Jacksonì´ í”„ë¡œí¼í‹°ë¥¼ ì§ë ¬í™” í•  ë•Œ getterë¥¼ ì‚¬ìš©í•˜ì—¬ ê°’ì„ ì½ê¸° ë•Œë¬¸ì— DTOì— @Getter ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ë“± Rest APIë¥¼ êµ¬ì„±í•  ë•Œ ë” ì„¸ë¶€ì ìœ¼ë¡œ ê³ ë¯¼í•´ì•¼ í•  ìš”ì†Œë“¤ì´ ë§ì´ ìˆì§€ë§Œ í”„ë¡ íŠ¸ë¥¼ ì§ì ‘ êµ¬í˜„í•´ë³´ì§€ì•Šìœ¼ë©´ ì•Œê¸° ì–´ë ¤ì› ë˜ ë§Œí¼ Rest APIë¡œ êµ¬í˜„í•´ë³´ê¸¸ ì˜í•œ ê²ƒ ê°™ë‹¤.

</details>

<details>
<summary><strong>Board Entity - Image Entity ìˆœí™˜ì°¸ì¡°</strong></summary>


## ë¬¸ì œ.

ê²Œì‹œê¸€ ìƒì„± ì‹œ, ì´ë¯¸ì§€ì™€ í•¨ê»˜ ìƒì„±ì„ í•˜ê²Œ ë˜ë©´ ë°˜í™˜ê°’ì´ ìë‹ˆì¹˜ê²Œ í¬ê³  ê¸´ ì´ìƒí•œ ì ì„ ë°œê²¬í–ˆë‹¤.  
í•´ë‹¹ ë¬¸ì œëŠ” Boardì™€ Imageê°€ ì„œë¡œ ì°¸ì¡°ë¥¼ í•˜ë©´ì„œ ë°˜í™˜ê°’ ë˜í•œ ì„œë¡œ ì°¸ì¡°í•˜ëŠ” ê²°ê³¼ê°’ì´ ë‚˜ì™€  
Stack Over Flowê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ì—ˆë‹¤.

Postmanìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•  ë• ê²Œì‹œê¸€ì´ ìƒì„±ì´ ë˜ì—ˆì§€ë§Œ ì›¹ ë¸Œë¼ìš°ì €ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë©´ ìƒì„±ë˜ì§€ ì•Šì•˜ë‹¤.

### ì—ëŸ¬ ì½”ë“œ.(Stack Over Flow)

```java
Ignoring exception, response committed already: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: Infinite recursion (StackOverflowError)
Resolved [org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: Infinite recursion (StackOverflowError)]
```

### Board Entity

```java
import com.example.stagealarm.BaseEntity;
import com.example.stagealarm.image.entity.Image;
import com.example.stagealarm.user.entity.UserEntity;
import jakarta.persistence.*;
import lombok.*;

import java.util.ArrayList;
import java.util.List;

@Getter
@Builder
@Entity
@NoArgsConstructor
@AllArgsConstructor
public class Board  extends BaseEntity {
  @Column(nullable = false)
  @Setter
  private String title;
  @Setter
  private String content;
  @Enumerated(EnumType.STRING)
  @Setter
  private ActivateEnum activate; //todo: Enum ì‹ ê³ ë¡œ ë°”ë€Œì—ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬
  @Setter
  private Long views;

  @ManyToOne(fetch = FetchType.LAZY)
  @Setter
  private Category category;

  @ManyToOne(fetch = FetchType.LAZY)
  private UserEntity userEntity;

  @OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY)
  private List<Image> imageList;

  @OneToMany(mappedBy = "board", fetch = FetchType.LAZY)
  private List<BoardComment> commentList = new ArrayList<>();

  public void addImage(Image image) {
    // í˜„ì¬ Board ì¸ìŠ¤í„´ìŠ¤ì— Image ê°ì²´ë¥¼ ì¶”ê°€
    this.imageList.add(image);
    // Image ê°ì²´ì˜ Board ì°¸ì¡°ë¥¼ í˜„ì¬ Board ì¸ìŠ¤í„´ìŠ¤ë¡œ ì„¤ì •
    image.setBoard(this);
  }

  public static Board.BoardBuilder customBuilder() {
    return builder()
      .commentList(new ArrayList<>())
      .imageList(new ArrayList<>());
  }
}
```

### Image Entity

```java
import com.example.stagealarm.BaseEntity;
import com.example.stagealarm.board.entity.Board;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.ManyToOne;
import lombok.*;

@Getter
@Builder
@Entity
@NoArgsConstructor
@AllArgsConstructor
public class Image extends BaseEntity {
  @Column(nullable = false)
  private String imgUrl;

  @ManyToOne(fetch = FetchType.LAZY)
  @Setter
  private Board board;
}
```

### ë°˜í™˜ê°’(Postman) - 525ms, 405.31KB

```java
{
    "id": 4,
    "title": "test",
    "content": "test",
    "activate": "ACTIVATE",
    "views": 0,
    "userId": 2,
    "loginId": "user",
    "categoryId": 1,
    "createdAt": "2024-04-03T20:04:02.1838",
    "imageList": [
        {
            "id": 3,
            "createdAt": "2024-04-03T20:04:02.179216",
            "imgUrl": "https://s3.ap-northeast-2.amazonaws.com/java-test-s3/boardImg/ded4a01c-7f27-40a9-b814-d3b556ec35b4.png",
            "board": {
                "id": 4,
                "createdAt": "2024-04-03T20:04:02.1838",
                "title": "test",
                "content": "test",
                "activate": "ACTIVATE",
                "views": 0,
                "category": {
                    "id": 1,
                    "category": "ê³µì—° í›„ê¸°"
                },
                "userEntity": {
                    "id": 2,
                    "createdAt": "2024-04-03T17:31:18.739",
                    "loginId": "user",
                    "password": "$2a$10$9vANwbo5MJFzY029Pe0KFea1njGXu8SmjiDusK9uLGIWqpm48r8I2",
                    "email": "hhhjs0133@naver.com",
                    "nickname": "ì¼ë°˜ ì‚¬ìš©ì1",
                    "gender": null,
                    "phone": null,
                    "profileImg": null,
                    "address": null,
                    "authorities": "ROLE_USER",
                    "likeList": [],
                    "genreSubscribeList": [],
                    "artistSubscribeList": []
                },
                "imageList": [
                    {
                        "id": 3,
                        "createdAt": "2024-04-03T20:04:02.179216",
                        "imgUrl": "https://s3.ap-northeast-2.amazonaws.com/java-test-s3/boardImg/ded4a01c-7f27-40a9-b814-d3b556ec35b4.png",
                        "board": {
                            "id": 4,
                            "createdAt": "2024-04-03T20:04:02.1838",
                            "title": "test",
                            "content": "test",
                            "activate": "ACTIVATE",
                            "views": 0,
                            "category": {
                                "id": 1,
                                "category": "ê³µì—° í›„ê¸°"
                            },
                            "userEntity": {
                                "id": 2,
                                "createdAt": "2024-04-03T17:31:18.739",
                                "loginId": "user",
                                "password": "$2a$10$9vANwbo5MJFzY029Pe0KFea1njGXu8SmjiDusK9uLGIWqpm48r8I2",
                                "email": "hhhjs0133@naver.com",
                                "nickname": "ì¼ë°˜ ì‚¬ìš©ì1",
                                "gender": null,
                                "phone": null,
                                "profileImg": null,
                                "address": null,
                                "authorities": "ROLE_USER",
                                "likeList": [],
                                "genreSubscribeList": [],
                                "artistSubscribeList": []
                            },
                            // ... ë¬´í•œ ë°˜ë³µ ...
```

![Untitled](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/a7fce8f2-ae85-4da5-9fbb-d1a8ef7fef6a/Untitled.png?id=8783e3ca-1526-4dbf-8952-bd1116b53672&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712368800000&signature=p3abst2TqYgveD-7VyJMhyVY0bVnHwYBIAbsBRt27dw&downloadName=Untitled.png)

## í•´ê²°.

`@JsonManagedReference`ì™€ `@JsonBackReference` ì„ ì‚¬ìš©í•´ì„œ ìˆœí™˜ ì°¸ì¡°ë¥¼ í•´ê²°í–ˆë‹¤.  
JPA ì—”í‹°í‹°ë‚˜ ë‹¤ë¥¸ ê°ì²´ ê´€ê³„ì—ì„œ ìˆœí™˜ ì°¸ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ë“¤ì„ ì‚¬ìš©í•œë‹¤.  
`@JsonManagedReference`ì€ ìˆœí™˜ì°¸ì¡°ì˜ â€œë¶€ëª¨â€ìª½ì—, `@JsonBackReference`ì€ â€œìì‹â€ìª½ì— ë¶™ì—¬ ì‚¬ìš©í•œë‹¤.

### Board Entity

```java
import com.example.stagealarm.BaseEntity;
import com.example.stagealarm.image.entity.Image;
import com.example.stagealarm.user.entity.UserEntity;
import com.fasterxml.jackson.annotation.JsonManagedReference;
import jakarta.persistence.*;
import lombok.*;

import java.util.ArrayList;
import java.util.List;

@Getter
@Builder
@Entity
@NoArgsConstructor
@AllArgsConstructor
public class Board  extends BaseEntity {
  @Column(nullable = false)
  @Setter
  private String title;
  @Setter
  private String content;
  @Enumerated(EnumType.STRING)
  @Setter
  private ActivateEnum activate; //todo: Enum ì‹ ê³ ë¡œ ë°”ë€Œì—ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬
  @Setter
  private Long views;

  @ManyToOne(fetch = FetchType.LAZY)
  @Setter
  private Category category;

  @ManyToOne(fetch = FetchType.LAZY)
  private UserEntity userEntity;

  @OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY)
	@JsonManagedReference
  private List<Image> imageList;

  @OneToMany(mappedBy = "board", fetch = FetchType.LAZY)
  private List<BoardComment> commentList = new ArrayList<>();

  public void addImage(Image image) {
    // í˜„ì¬ Board ì¸ìŠ¤í„´ìŠ¤ì— Image ê°ì²´ë¥¼ ì¶”ê°€
    this.imageList.add(image);
    // Image ê°ì²´ì˜ Board ì°¸ì¡°ë¥¼ í˜„ì¬ Board ì¸ìŠ¤í„´ìŠ¤ë¡œ ì„¤ì •
    image.setBoard(this);
  }

  public static Board.BoardBuilder customBuilder() {
    return builder()
      .commentList(new ArrayList<>())
      .imageList(new ArrayList<>());
  }
}
```

### Image Entity

```java
import com.example.stagealarm.BaseEntity;
import com.example.stagealarm.board.entity.Board;
import com.fasterxml.jackson.annotation.JsonBackReference;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.ManyToOne;
import lombok.*;

@Getter
@Builder
@Entity
@NoArgsConstructor
@AllArgsConstructor
public class Image extends BaseEntity {
  @Column(nullable = false)
  private String imgUrl;

  @ManyToOne(fetch = FetchType.LAZY)
	@JsonBackReference
  @Setter
  private Board board;
}
```

### ë°˜í™˜ê°’ 1045ms, 938B
```java
{
    "id": 5,
    "title": "test",
    "content": "test",
    "activate": "ACTIVATE",
    "views": 0,
    "userId": 2,
    "loginId": "user",
    "categoryId": 1,
    "createdAt": "2024-04-03T20:13:46.114877",
    "imageList": [
        {
            "id": 5,
            "createdAt": "2024-04-03T20:13:46.100346",
            "imgUrl": "https://s3.ap-northeast-2.amazonaws.com/java-test-s3/boardImg/2d921929-4280-442d-ac49-9f43f7be44df.png"
        },
        {
            "id": 6,
            "createdAt": "2024-04-03T20:13:46.109876",
            "imgUrl": "https://s3.ap-northeast-2.amazonaws.com/java-test-s3/boardImg/2b6e8b43-54b4-434d-a610-3bdbda4a9d4e.png"
        }
    ],
    "commentList": []
}
```
![ì´ë¯¸ì§€](https://file.notion.so/f/f/c69962b0-3951-485b-b10a-5bb29576bba8/986421aa-ff28-4f19-97fe-f0b2baa68ab0/Untitled.png?id=970ef00b-590e-4934-8c82-f39a7a92bb55&table=block&spaceId=c69962b0-3951-485b-b10a-5bb29576bba8&expirationTimestamp=1712368800000&signature=UZhnd5iiu0043jd4AiSZqMMCBSQ3guAplbmMO3cGrz0&downloadName=Untitled.png)

</details>


<details>
<summary><strong>ì†Œì…œë¡œê·¸ì¸ ì‹œ, í† í°ì„ ì•ˆì „í•˜ê²Œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•˜ê¸°</strong></summary>

### ìƒí™©

- ì†Œì…œë¡œê·¸ì¸í• ë•Œ `OAuth2SuccessHandler` ê¹Œì§€ ë„ë‹¬í•˜ê³ ë‚˜ì„œ í† í°ì„ ë°œê¸‰í•˜ëŠ”ë° ì´ í† í°ì„ ì–´ë–»ê²Œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì•ˆì „í•˜ê²Œ ë³´ë‚¼ìˆ˜ ìˆì„ê¹Œ?
- ì†Œì…œë¡œê·¸ì¸ ì„±ê³µì‹œì— í† í°ì„ ì¿¼ë¦¬íŒŒë¼ë¯¸í„°ë¡œ ë³´ë‚¼ìˆ˜ëŠ” ìˆì§€ë§Œ URLì— ë‹¤ ë…¸ì¶œì´ ë˜ê¸°ë•Œë¬¸ì— ìµœì†Œí•œ **Response Header**ì— ë³´ë‚´ê³  ì‹¶ì§€ë§Œ ì‚¬ì‹¤ ë³´ì•ˆì ì¸ ìˆ˜ì¤€ì—ì„œëŠ” ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ë³´ë‚´ë‚˜ í—¤ë”ë¡œ ë³´ë‚´ë‚˜ ë°”ë””ë¡œ ë³´ë‚´ë‚˜ í† í°ì„ íƒˆì·¨í•˜ëŠ”ê²ƒì€ í° ì°¨ì´ê°€ ì—†ë‹¤ê³  í•œë‹¤.
- ë”°ë¼ì„œ ë” ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ í•´ê²°ì±…ë“¤ì„ ê³µë¶€í•´ ë³´ì•˜ë‹¤.

### í•´ê²°ì„ ìœ„í•œ ê³µë¶€

- `SimpleUrlAuthenticatoinSuccessHandler` ë¥¼ ìƒì†í• ê²½ìš° íŠ¹ì • URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë§Œ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— í† í°ì„ http í—¤ë”ë‚˜ ë°”ë””ì— í¬í•¨ì‹œí‚¬ìˆ˜ê°€ ì—†ë‹¤. (ë¦¬ë‹¤ì´ë ‰íŠ¸ì‹œì— ì´ˆê¸° í—¤ë”ì •ë³´ëŠ” ë‹¤ìŒ ìš”ì²­ìœ¼ë¡œ ì „ë‹¬ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì—)
- í¬ê²Œ ë‘ê°€ì§€ í•´ê²°ì±…ì´ ìˆë‹¤ëŠ”ê±¸ ì•Œì•˜ëŠ”ë° ì¿ í‚¤ì— jwt í† í°ì„ í¬í•¨ì‹œí‚¤ê±°ë‚˜ í—¤ë”ì— í¬í•¨ì‹œí‚¤ëŠ” ë°©ë²•ì´ ìˆë‹¤.
- ì²«ë²ˆì§¸ ë°©ë²•ì€ ì›ë˜ëŒ€ë¡œ `SimpleUrlAuthenticatoinSuccessHandler` ì„ ì“°ë˜ ë¦¬ë‹¤ì´ë ‰íŠ¸ì‹œì— jwt í† í°ì„ ì¿ í‚¤ì— ë„£ì–´ì„œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
- ë‘ë²ˆì§¸ë¡œ í—¤ë”ì— í¬í•¨ì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ `SimpleUrlAuthenticatoinSuccessHandler` ê°€ ì•„ë‹ˆë¼ `OAuth2AuthenticationSuccessHandler` ë¥¼ ìƒì†í•´ì„œ ì—¬ê¸°ì„œ í—¤ë”ì— í¬í•¨ì‹œí‚¤ëŠ” ë°©ë²•ì´ ìˆë‹¤. ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” í—¤ë”ì— bearer jwt í† í°ì„ í¬í•¨ì‹œí‚¤ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í–ˆê¸° ë•Œë¬¸ì— ì—¬ê¸°ê¹Œì§€ í•˜ë”ë¼ë„ í˜„ì¬ ë³´ì•ˆìˆ˜ì¤€ì„ ë§Œì¡±í•˜ì§€ë§Œ ë§Œì•½ **ê³µê²©ìê°€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì „ì†¡ë˜ëŠ” ë°ì´í„° íŒ¨í‚·ì„ ê°€ë¡œì±„ê±°ë‚˜ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë°ì´í„° ìŠ¤ë‹ˆí•‘(Data Sniffing)**ì„ ****í•œë‹¤ë©´ í† í°ì´ íƒˆì·¨ ë‹¹í• ìˆ˜ë„ ìˆê¸°ë•Œë¬¸ì— ë” ìš•ì‹¬ì´ ìƒê²¨ ë‚˜ì¤‘ì— ìˆì„ ë³´ì•ˆì˜ í™•ì¥ì„±ì„ ìœ„í•´ ì¢€ ë” ê³µë¶€ë¥¼ í•´ë³´ì•˜ë‹¤.
- ê²°êµ­ ì¿ í‚¤ë‚˜ í—¤ë” ëª¨ë‘ íƒˆì·¨ë‹¹í•  ê°€ëŠ¥ì„±ì´ ìˆëŠ”ë° ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ë” ì—¬ëŸ¬ê°€ì§€ ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ë‹¨ì´ ìˆë‹¤ëŠ”ê²ƒì„ ì•Œê²Œë¼ì„œ ì†Œì…œë¡œê·¸ì¸ì‹œì— ì¿ í‚¤ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì„ íƒí–ˆë‹¤.
- ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ì¿ í‚¤ì— Secure í”Œë˜ê·¸ë¥¼ ì„¤ì •í•¨ìœ¼ë¡œì¨ HTTPSÂ í”„ë¡œí† ì½œì¼ ê²½ìš°ì—ë§Œ ì¿ í‚¤ë¥¼ ì „ë‹¬í•˜ì—¬ **ì¤‘ê°„ì ê³µê²©(man-in-the-middle attack)**ìœ¼ë¡œ ì¿ í‚¤ ì •ë³´ë¥¼ ë³´í˜¸í•  ìˆ˜ ìˆë‹¤. (í˜„ì¬ëŠ” ê°œë°œë‹¨ê³„ í”„ë¡œì íŠ¸ ì„ìœ¼ë¡œ ì´ ì„¤ì •ì„ trueë¡œ í•˜ë”ë¼ë„ httpë¡œ ë³´ë‚´ì§ì„ í™•ì¸í–ˆë‹¤)
- ì¶”ê°€ë¡œ HttpOnly í”Œë˜ê·¸ë¥¼ ì„¤ì •í•´ì„œ `javascript` ì—ì„œëŠ” ì¿ í‚¤ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ê³  ì„œë²„ì¸¡ì—ì„œë§Œ ì ‘ê·¼í• ìˆ˜ ìˆê²Œ ì„¤ì •í• ìˆ˜ìˆë‹¤. ì´ê²ƒì„ ì„¤ì •í•´ì„œ **ê³µê²©ìê°€ ìƒëŒ€ë°©ì˜ ë¸Œë¼ìš°ì €ì— ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ë„ë¡ í•´ì„œ ì •ë³´ë¥¼ íƒˆì·¨í•˜ëŠ” XSS(Cross Site Scripting)** ê³µê²©ìœ¼ë¡œë¶€í„° ì¿ í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í• ìˆ˜ ìˆë‹¤. (ì§€ê¸ˆì€ í¸ì˜ë¥¼ ìœ„í•´ ì´ì„¤ì •ì„ false í•˜ê³  ì¿ í‚¤ì— ë“¤ì–´ìˆëŠ” ë°ì´í„°ë§Œ êº¼ë‚´ê³  ë°”ë¡œ ì‚­ì œí•˜ë„ë¡ í–ˆë‹¤. ë‚˜ì¤‘ì— ë³´ì•ˆ ì¡°ê±´ì´ ê°•í™”ë˜ë©´ trueë¡œ ë°”ê¿€ìˆ˜ìˆë‹¤)

### ì½”ë“œ êµ¬í˜„(ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì¿ í‚¤ ì „ë‹¬)

```java
package com.example.stagealarm.oauth;

import com.example.stagealarm.jwt.JwtTokenUtils;
import com.example.stagealarm.user.dto.UserDto;
import com.example.stagealarm.user.service.UserService;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler;
import org.springframework.stereotype.Component;

import java.io.IOException;
import java.util.Objects;

@Slf4j
@Component
@RequiredArgsConstructor
public class OAuth2SuccessHandler
        extends SimpleUrlAuthenticationSuccessHandler {
    // JWT ë°œê¸‰ì„ ìœ„í•´ JwtTokenUtils
    private final JwtTokenUtils tokenUtils;
    // ì‚¬ìš©ì ì •ë³´ ë“±ë¡ì„ ìœ„í•´ UserService
    private final UserService userService;
    private final PasswordEncoder passwordEncoder;

    @Override
    public void onAuthenticationSuccess(
            HttpServletRequest request,
            HttpServletResponse response,
            Authentication authentication
    ) throws IOException, ServletException {
        // OAuth2UserServiceImplì˜ ë°˜í™˜ê°’ì´ í• ë‹¹ëœë‹¤.
        OAuth2User oAuth2User
                = (OAuth2User) authentication.getPrincipal();

        // ë„˜ê²¨ë°›ì€ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¤€ë¹„
        String email = oAuth2User.getAttribute("email");
        String provider = oAuth2User.getAttribute("provider");
        String username
                = String.format("%s:%s", provider, email);
        String providerId = oAuth2User.getAttribute("id").toString();
        String nickname = oAuth2User.getAttribute("nickname");

        // ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬
        if (userService.existsByEmail(email)) {
            // ì¤‘ë³µëœ ì´ë©”ì¼ì´ ìˆì„ ê²½ìš°, ê³¼ê±°ì— ê°€ì…í•œ sns ê°€ ì•„ë‹ì‹œ ì¤‘ë³µ ì•Œë¦¼ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            String sns= userService.searchByEmail(email).getLoginId().split(":")[0];
            if(!Objects.equals(provider, sns)){
                String duplicateEmailPage = "http://localhost:8080/user/emailDuplicate";
                getRedirectStrategy().sendRedirect(request, response, duplicateEmailPage);
                return;
            }
        }

        // ì²˜ìŒìœ¼ë¡œ ì´ ì†Œì…œ ë¡œê·¸ì¸ìœ¼ë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í–ˆë‹¤.
        if (!userService.userExists(username)) {
            // ìƒˆ ê³„ì •ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
            userService.joinWithoutFile(UserDto.builder()
                    .loginId(username)
                    .email(email)
                    .nickname(nickname)
                    .password(passwordEncoder.encode(providerId))
                    .build());

        }
        log.info(username);

        // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ê³„ì • íšŒìˆ˜
        UserDetails details
                = userService.loadUserByUsername(username);
        // JWT ìƒì„±
        String jwt = tokenUtils.generateToken(details);

        // ì¿ í‚¤ì— JWT í† í° ì €ì¥
        Cookie jwtCookie = new Cookie("auth_token", jwt); // "auth_token"ì€ ì¿ í‚¤ì˜ ì´ë¦„ì…ë‹ˆë‹¤.

        // ì¿ í‚¤ ì„¤ì • (ì˜µì…˜)
        jwtCookie.setHttpOnly(false); // JavaScriptë¥¼ í†µí•œ ì ‘ê·¼ ë°©ì§€ false -> í”„ë¡ íŠ¸ì—ì„œ ë°”ë¡œ êº¼ë‚´ê³  ì§€ìš¸ìš©ë„ì„
        jwtCookie.setSecure(true); // HTTPS ë¥¼ í†µí•´ì„œë§Œ ì¿ í‚¤ë¥¼ ì „ì†¡
        jwtCookie.setPath("/"); // ì‚¬ì´íŠ¸ ì „ì—­ì—ì„œ ì¿ í‚¤ ì ‘ê·¼ ê°€ëŠ¥

        // ì‘ë‹µì— ì¿ í‚¤ ì¶”ê°€
        response.addCookie(jwtCookie);
        // oauthClient ëŠ” JWT ë¥¼ ì²˜ë¦¬í•  í´ë¼ì´ì–¸íŠ¸ì¸¡ í˜ì´ì§€ë¥¼ ì—°ê²°í•´ì¤Œ
        String redirectUrl = "http://localhost:8080/user/oauthClient";
        getRedirectStrategy().sendRedirect(request, response, redirectUrl);
        // í† í°ì„ -> ì¿ í‚¤ -> ë¦¬ë‹¤ì´ë ‰íŠ¸
    }
}

```

### í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¿ í‚¤ì—ìˆëŠ” ì •ë³´ ì¶”ì¶œ



```jsx
document.addEventListener("DOMContentLoaded", function() {
        // ì¿ í‚¤ì—ì„œ íŠ¹ì • ì´ë¦„ì˜ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // ì¿ í‚¤ì˜ ì´ë¦„ì„ ì°¾ìœ¼ë©´ ê°’ì„ ë°˜í™˜
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // 'auth_token' ì¿ í‚¤ì˜ ê°’ì„ localStorageì— ì €ì¥
        const jwtToken = getCookie('auth_token');
        if (jwtToken) {
            localStorage.setItem('jwtToken', jwtToken);
            console.log('JWT saved to localStorage');

            // ì¿ í‚¤ ì‚­ì œí•˜ê¸° ìœ„í•´ ê³¼ê±° ì‹œê°„ ì„¤ì •
            document.cookie = "auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            // í•„ìš”í•œ ë¡œì§ ìˆ˜í–‰, ì˜ˆ: í™ˆí˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
            location.href = '/';
        } else {
            console.log('No JWT token found in cookies');
        }
    });
```

- í˜„ì¬ëŠ” Bearer Token ë°©ì‹ìœ¼ë¡œ í† í°ì„ ì¶”ì¶œí•˜ì§€ë§Œ ë‚˜ì¤‘ì—ëŠ” ì¿ í‚¤ë¡œë¶€í„° jwtí† í°ì„ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ë°œì „í• ìˆ˜ ìˆë‹¤.
- **ì´ ë°©ì‹ì„ ì“¸ê²½ìš° ë³´ì•ˆì€ ê°•í™”ë˜ì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¿ í‚¤ ì •ë³´ë¥¼ ì½ì„ìˆ˜ ì—†ì–´ì„œ í•„ìš”í•œ ê°œë³„ ì •ë³´ë“¤ì„ ê°ê° apië¡œ ìš”ì²­í•´ì„œ ì–»ì–´ì•¼í•˜ê¸°ë•Œë¬¸ì— ë¡œì§ì˜ ë³µì¡ì„±ì€ ì¦ê°€í•˜ê²Œ ëœë‹¤.**
- ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” í¸ì˜ë¥¼ ìœ„í•´ ì£¼ë¡œ í—¤ë”ì— í† í°ì²¨ë¶€í•˜ëŠ” ë°©ì‹ì„ íƒí–ˆê³  ì œí•œë˜ëŠ” ìƒí™©ì—ì„œë§Œ ì¿ í‚¤ë¥¼ ë„ì…í–ˆë‹¤. ë‚˜ì¤‘ì— ë³´ì•ˆ ì¡°ê±´ ìˆ˜ì¤€ì´ ë†’ì•„ì¡Œì„ë•Œë¥¼ ëŒ€ë¹„í•´ì„œ ì¿ í‚¤ë¥¼ ì´ìš©í•œ SpringSecurity Filter ì½”ë“œë¥¼ ì•„ë˜ì— ì‘ì„±í–ˆë‹¤.

### ì¿ í‚¤ ë°©ì‹ì˜ SpringSecurity(ë³´ì•ˆ ê°•í™” ë²„ì „, í˜„ì¬ëŠ” ë¯¸ì ìš© ìƒíƒœ)

```java
public class JwtTokenFilter extends OncePerRequestFilter {
    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        // ì¿ í‚¤ì—ì„œ JWT í† í° ì¶”ì¶œ
        String token = extractJwtFromCookie(request);
        // í† í°ì´ ìœ íš¨í•˜ë‹¤ë©´
        if (token != null && jwtTokenUtils.validate(token)) {
            SecurityContext context = SecurityContextHolder.createEmptyContext();
                // ì‚¬ìš©ì ì •ë³´ íšŒìˆ˜
                Claims jwtClaims = jwtTokenUtils
                        .parseClaims(token);

                String loginId = jwtClaims.getSubject();
                String authorities = jwtClaims.get("roles", String.class);

                CustomUserDetails customUserDetails = CustomUserDetails.builder()
                        .loginId(loginId)
                        .authorities(authorities)
                        .build();

                // ì¸ì¦ ì •ë³´ ìƒì„±
                AbstractAuthenticationToken authentication =
                        new UsernamePasswordAuthenticationToken(
                                customUserDetails,
                                token,
                                customUserDetails.getAuthorities()
                        );
                // ì¸ì¦ ì •ë³´ ë“±ë¡
                context.setAuthentication(authentication);
                SecurityContextHolder.setContext(context);
                log.info("set security context with jwt");

        }
        else {
                log.warn("jwt validation failed");
        }
        // ë‹¤ìŒ í•„í„° í˜¸ì¶œ
        filterChain.doFilter(request, response);
    }

    private String extractJwtFromCookie(HttpServletRequest request) {
        Cookie[] cookies = request.getCookies();
        if (cookies != null) {
            for (Cookie cookie : cookies) {
                if ("JWT_COOKIE".equals(cookie.getName())) {
                    return cookie.getValue();
                }
            }
        }
        return null;
    }
}
```

### ê¸°íƒ€ ëŠë‚€ì 

- í† í°ì„ ë‹¤ë£¨ê²Œ ë˜ë©´ì„œ ë³´ì•ˆì— ê´€ì‹¬ì´ ë†’ì•„ì§€ê³  ì–´ë–¨ë•Œ ë³´ì•ˆì´ ì·¨ì•½í•´ì§€ëŠ”ì§€ ê³ ë¯¼í• ìˆ˜ ìˆëŠ” ì‹œê°„ì„ ê°€ì§€ê²Œ ë˜ì—ˆê³  ë‚˜ì¤‘ì— ìˆì„ ìƒí™©ì— ëŒ€í•œ ëŒ€ì²˜ëŠ¥ë ¥ì„ ê¸°ë¥¼ìˆ˜ ìˆëŠ” ì‹œê°„ì´ì˜€ë‹¤.
- í† í°ì—ëŒ€í•œ ë‘ê°€ì§€ ë°©ë²• ëª¨ë‘ ê°ê° íŠ¸ë ˆì´ë“œì˜¤í”„ê°€ ìˆê¸°ë•Œë¬¸ì— ìš”êµ¬ì¡°ê±´ì„ ì´í•´í•˜ê³  ì ì ˆíˆ ì‚¬ìš©í•˜ëŠ” ì—­ëŸ‰ì„ ê¸°ë¥¼ìˆ˜ ìˆì—ˆë‹¤.
- ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë ‡ê²Œ ì¿ í‚¤ì„ í™œìš©í•˜ê³  ë³´ë‹ˆê¹Œ í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œê°€ ì™„ë²½íˆ ë¶„ë¦¬ëœ ìƒí™©ì—ì„œ
  í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•œ ì •ë³´ë“¤ì„ SpringMVCì˜ modelì„ í†µí•´ì„œê°€ ì•„ë‹Œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ì „ë‹¬í• ìˆ˜  ìˆìŒì„ ê²½í—˜ìœ¼ë¡œ ì•Œê²Œ ë˜ì—ˆê³  ë‹¤ë¥¸ê³³ì—ë„ í™œìš©í• ìˆ˜ ìˆì—ˆë‹¤.

</details>


## ğŸ“‘ ê·¸ ì™¸ ì°¸ê³ ìë£Œ

[Notion íŒ€ í˜ì´ì§€](https://www.notion.so/likelion/2-b4ae698de11c4901950888a6ee4e8276)  
[êµ¬ê¸€ Docs](https://docs.google.com/spreadsheets/d/1WacFNxTyaTTMJUTAr5o31jfDy5gTPPctyxTsqtqr4E4/edit#gid=1882734205)  
[Figma](https://www.figma.com/file/30qML24bA9FAcJKJfDpdWA/Untitled?type=design&node-id=0-1&mode=design&t=BBJQwYdkh4aKToZn-0)


